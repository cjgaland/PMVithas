<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbapenems - Protocolo Antibióticos</title>
    
    <!-- Dependencias Externas (Tailwind y D3) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- Estilos Globales -->
    <link rel="stylesheet" href="../../../css/style.css" />
    <!-- Estilos Locales del Módulo Antibióticos -->
    <link rel="stylesheet" href="../Antibioticos/antibioticos-style.css" />

</head>
<body>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="../../../assets/images/Logos/Vithas-Logo.jpg" alt="Vithas" class="sidebar-logo">
        </div>
        <nav class="nav-links">
            <ul>
                <li><a href="../../../index.html"><i class="fas fa-home"></i> Inicio</a></li>
                <li class="nav-category">Práctica Clínica</li>
                <!-- Enlace de retorno directo a la Guía Principal -->
                <li><a href="../guia-antibioticos.html"><i class="fas fa-arrow-left"></i> Volver a Guía Antibióticos</a></li>
                
                <!-- BLOQUE ACTUAL: Antibióticos (ABIERTO) -->
                <li class="has-submenu open">
                    <a href="#" class="submenu-toggle">
                        <div style="display:flex; align-items:center;">
                            <i class="fas fa-capsules"></i> Antibióticos
                        </div>
                    </a>
                    <!-- Lista de familias (Hermanos) con ICONOS -->
                    <ul class="submenu">
                        <li><a href="Penicilinas.html"><i class="fas fa-shield-virus"></i> Penicilinas</a></li>
                        <li><a href="Cefalosporinas.html"><i class="fas fa-capsules"></i> Cefalosporinas</a></li>
                        <!-- Elemento Activo -->
                        <li><a href="Carbapenems.html" class="submenu-main-link active"><i class="fas fa-syringe"></i> Carbapenems</a></li>
                        <li><a href="Fluorquinolonas.html"><i class="fas fa-dna"></i> Fluorquinolonas</a></li>
                        <li><a href="Macrolidos.html"><i class="fas fa-bacterium"></i> Macrólidos</a></li>
                        <li><a href="Aminoglucosidos.html"><i class="fas fa-prescription-bottle-alt"></i> Aminoglucósidos</a></li>
                        <li><a href="Tetraciclinas.html"><i class="fas fa-tablets"></i> Tetraciclinas</a></li>
                        <li><a href="Glicopeptidos.html"><i class="fas fa-shield-alt"></i> Glicopéptidos</a></li>
                        <li><a href="Lincosamidas.html"><i class="fas fa-biohazard"></i> Lincosamidas</a></li>
                        <li><a href="Oxazolidinonas.html"><i class="fas fa-dot-circle"></i> Oxazolidinonas</a></li>
                        <li><a href="Estreptograminas.html"><i class="fas fa-vial"></i> Estreptograminas</a></li>
                        <li><a href="Fenicoles.html"><i class="fas fa-flask"></i> Fenicoles</a></li>
                        <li><a href="Polimixinas.html"><i class="fas fa-spray-can"></i> Polimixinas</a></li>
                        <li><a href="Otros.html"><i class="fas fa-plus-circle"></i> Otros</a></li>
                    </ul>
                </li>

                <!-- Accesos directos a otras Utilidades (Nivel superior) -->
                <li class="nav-category">Otras Herramientas</li>
                
                <li class="has-submenu">
                    <a href="../../Analisis_Clinicos/index.html" class="submenu-toggle">
                        <div style="display:flex; align-items:center;">
                            <i class="fas fa-microscope"></i> Analíticas
                        </div>
                    </a>
                </li>

                <li class="has-submenu">
                    <a href="../../Gold_EPOC/index.html" class="submenu-toggle">
                        <div style="display:flex; align-items:center;">
                            <i class="fas fa-lungs"></i> Guía EPOC
                        </div>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="sidebar-footer">
            <p>Medicina Interna</p>
            <small>Vithas Xanit Internacional</small>
        </div>
    </aside>

    <div class="main-content">
        <!-- CABECERO GLOBAL -->
        <header class="top-header">
            <div class="header-left">
                <i class="fas fa-bars menu-toggle" id="menuToggle"></i>
                <h2><i class="fas fa-capsules" style="margin-right: 10px;"></i>Guía de Antibióticos</h2>
            </div>
            <div class="header-right">
                <img src="../../../assets/images/Logos/Logo-Vithas-Xanit-Internacional.png" alt="Logo" class="top-logo">
            </div>
        </header>

        <div class="content-wrapper abx-container">
            
            <!-- Selector de Antibiótico dentro de la familia -->
            <section class="abx-card">
                <!-- CABECERA INTEGRADA (Título + Instrucción en la misma línea visual) -->
                <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 20px; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid #f0f0f0;">
                    
                    <!-- Parte Izquierda: Icono y Nombre del Grupo -->
                    <div style="display: flex; align-items: center; gap: 15px; flex-grow: 1;">
                        <div style="background:#e0f2fe; color:#003A70; width:55px; height:55px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.75rem; flex-shrink:0;">
                            <i class="fas fa-syringe"></i>
                        </div>
                        <div>
                            <h1 style="color: #003A70; font-size: 1.75rem; margin: 0; font-weight: 700; line-height: 1.1;">Carbapenems</h1>
                        </div>
                    </div>
                    
                    <!-- Parte Derecha: Instrucción -->
                    <div style="color: #888; font-weight: 500; font-size: 0.95rem; display: flex; align-items: center;">
                        <span style="background: #f8fafc; padding: 5px 12px; border-radius: 20px; border: 1px solid #e2e8f0;">
                            <i class="fas fa-hand-point-up" style="margin-right: 6px; color: #009FE3;"></i> Seleccione fármaco:
                        </span>
                    </div>
                </div>

                <div class="grid-antibioticos" id="antibiotic-list">
                    <!-- Se rellena por JS -->
                </div>
            </section>

            <!-- Área de Detalles (oculta inicialmente) -->
            <section id="detail-area" class="abx-card hidden">
                <div id="content-area">
                    <!-- Detalles inyectados aquí -->
                </div>
            </section>

        </div>
        
        <footer class="footer">
            <p>&copy; 2025 Servicio de Medicina Interna - Hospital Vithas Xanit Internacional.</p>
        </footer>
    </div>

    <script>
        // === DATOS COMPLETOS DE LA FAMILIA CARBAPENEMS (6 ELEMENTOS) ===
        const antibioticsData = {
            "Imipenem/Cilastatina": {
                "cobertura": "Amplio espectro: Gram-positivos (excepto MRSA, VRE), Gram-negativos (incluyendo Pseudomonas aeruginosa, Enterobacteriaceae productoras de BLEE), anaerobios. Cilastatina inhibe la inactivación renal de imipenem.",
                "posologia": "Adultos: 500 mg cada 6h IV. Niños: 60-100 mg/kg/día IV en 4 dosis.",
                "eventos_adversos": "Náuseas, vómitos, diarrea, rash, convulsiones (dosis altas o IR), eosinofilia. Reacciones de hipersensibilidad.",
                "biodisponibilidad": "No oral (uso parenteral).",
                "precauciones": "Alergia a carbapenems, penicilinas o cefalosporinas. Ajustar en IR (riesgo de convulsiones).",
                "ajuste_renal_hepatica": "IR: Ajustar dosis según ClCr. IH: No requiere ajuste significativo.",
                "interacciones": "Ganciclovir (aumenta riesgo de convulsiones), valproato (disminuye niveles de valproato).",
                "alertas": ["Riesgo de convulsiones", "Reacciones de hipersensibilidad"],
                "coverage_profile": { "Staphylococcus aureus (SASM)": "Buena", "Staphylococcus aureus (SARM)": "Nula", "Streptococcus pyogenes": "Excelente", "Streptococcus pneumoniae (S)": "Excelente", "Streptococcus pneumoniae (I)": "Excelente", "Streptococcus pneumoniae (R)": "Buena", "Enterococcus faecalis": "Buena", "Enterococcus faecium (VRE)": "Nula", "Haemophilus influenzae": "Excelente", "Moraxella catarrhalis": "Excelente", "Escherichia coli": "Excelente", "Klebsiella spp.": "Excelente", "Otras Enterobacteriaceae (BLEE)": "Excelente", "Pseudomonas aeruginosa": "Excelente", "Acinetobacter baumannii": "Excelente", "Stenotrophomonas maltophilia": "Nula", "Bacteroides fragilis": "Excelente", "Clostridium difficile": "Nula", "Mycoplasma pneumoniae": "Nula", "Chlamydia pneumoniae": "Nula", "Legionella pneumophila": "Nula" }
            },
            "Imipenem/Relebactam": {
                "cobertura": "Carbapenem con inhibidor de beta-lactamasas. Activo contra Enterobacteriaceae productoras de KPC y Pseudomonas aeruginosa multirresistente, así como Gram-positivos (MSSA, Streptococcus).",
                "posologia": "Adultos: 1.25 g cada 6h IV.",
                "eventos_adversos": "Náuseas, diarrea, cefalea, convulsiones (raro).",
                "biodisponibilidad": "No oral (uso parenteral).",
                "precauciones": "Alergia a carbapenems. Ajustar en IR.",
                "ajuste_renal_hepatica": "IR: Ajustar dosis según ClCr. IH: No requiere ajuste significativo.",
                "interacciones": "Valproato.",
                "alertas": ["Alergia a carbapenems"],
                "coverage_profile": { "Staphylococcus aureus (SASM)": "Buena", "Staphylococcus aureus (SARM)": "Nula", "Streptococcus pyogenes": "Excelente", "Streptococcus pneumoniae (S)": "Excelente", "Streptococcus pneumoniae (I)": "Excelente", "Streptococcus pneumoniae (R)": "Buena", "Enterococcus faecalis": "Buena", "Enterococcus faecium (VRE)": "Nula", "Haemophilus influenzae": "Excelente", "Moraxella catarrhalis": "Excelente", "Escherichia coli": "Excelente", "Klebsiella spp.": "Excelente", "Otras Enterobacteriaceae (BLEE)": "Excelente", "Pseudomonas aeruginosa": "Excelente", "Acinetobacter baumannii": "Excelente", "Stenotrophomonas maltophilia": "Nula", "Bacteroides fragilis": "Excelente", "Clostridium difficile": "Nula", "Mycoplasma pneumoniae": "Nula", "Chlamydia pneumoniae": "Nula", "Legionella pneumophila": "Nula" }
            },
            "Meropenem": {
                "cobertura": "Muy amplio espectro: Similar a imipenem, pero con menor riesgo de convulsiones. Activo contra la mayoría de Gram-positivos (excepto MRSA, VRE), Gram-negativos (incluyendo Pseudomonas aeruginosa, Enterobacteriaceae productoras de BLEE), anaerobios.",
                "posologia": "Adultos: 500 mg - 1 g cada 8h IV. Niños: 20 mg/kg cada 8h IV.",
                "eventos_adversos": "Náuseas, vómitos, diarrea, rash, cefalea. Menor riesgo de convulsiones que imipenem.",
                "biodisponibilidad": "No oral (uso parenteral).",
                "precauciones": "Alergia a carbapenems, penicilinas o cefalosporinas. Ajustar en IR.",
                "ajuste_renal_hepatica": "IR: Ajustar dosis según ClCr. IH: No requiere ajuste significativo.",
                "interacciones": "Valproato (disminuye niveles de valproato).",
                "alertas": ["Alergia a carbapenems"],
                "coverage_profile": { "Staphylococcus aureus (SASM)": "Buena", "Staphylococcus aureus (SARM)": "Nula", "Streptococcus pyogenes": "Excelente", "Streptococcus pneumoniae (S)": "Excelente", "Streptococcus pneumoniae (I)": "Excelente", "Streptococcus pneumoniae (R)": "Buena", "Enterococcus faecalis": "Buena", "Enterococcus faecium (VRE)": "Nula", "Haemophilus influenzae": "Excelente", "Moraxella catarrhalis": "Excelente", "Escherichia coli": "Excelente", "Klebsiella spp.": "Excelente", "Otras Enterobacteriaceae (BLEE)": "Excelente", "Pseudomonas aeruginosa": "Excelente", "Acinetobacter baumannii": "Excelente", "Stenotrophomonas maltophilia": "Nula", "Bacteroides fragilis": "Excelente", "Clostridium difficile": "Nula", "Mycoplasma pneumoniae": "Nula", "Chlamydia pneumoniae": "Nula", "Legionella pneumophila": "Nula" }
            },
            "Meropenem/Vaborbactam": {
                "cobertura": "Carbapenem con inhibidor de beta-lactamasas. Activo contra Enterobacteriaceae productoras de KPC y otras carbapenemasas, y Pseudomonas aeruginosa.",
                "posologia": "Adultos: 4 g cada 8h IV.",
                "eventos_adversos": "Náuseas, diarrea, cefalea, convulsiones (raro).",
                "biodisponibilidad": "No oral (uso parenteral).",
                "precauciones": "Alergia a carbapenems. Ajustar en IR.",
                "ajuste_renal_hepatica": "IR: Ajustar dosis según ClCr. IH: No requiere ajuste significativo.",
                "interacciones": "Valproato.",
                "alertas": ["Alergia a carbapenems"],
                "coverage_profile": { "Staphylococcus aureus (SASM)": "Buena", "Staphylococcus aureus (SARM)": "Nula", "Streptococcus pyogenes": "Excelente", "Streptococcus pneumoniae (S)": "Excelente", "Streptococcus pneumoniae (I)": "Excelente", "Streptococcus pneumoniae (R)": "Buena", "Enterococcus faecalis": "Buena", "Enterococcus faecium (VRE)": "Nula", "Haemophilus influenzae": "Excelente", "Moraxella catarrhalis": "Excelente", "Escherichia coli": "Excelente", "Klebsiella spp.": "Excelente", "Otras Enterobacteriaceae (BLEE)": "Excelente", "Pseudomonas aeruginosa": "Excelente", "Acinetobacter baumannii": "Excelente", "Stenotrophomonas maltophilia": "Nula", "Bacteroides fragilis": "Excelente", "Clostridium difficile": "Nula", "Mycoplasma pneumoniae": "Nula", "Chlamydia pneumoniae": "Nula", "Legionella pneumophila": "Nula" }
            },
            "Ertapenem": {
                "cobertura": "Amplio espectro: Gram-positivos (excepto MRSA, VRE), Gram-negativos (incluyendo Enterobacteriaceae productoras de BLEE). NO cubre Pseudomonas aeruginosa ni Acinetobacter. Conveniente dosificación una vez al día.",
                "posologia": "Adultos: 1 g cada 24h IV/IM.",
                "eventos_adversos": "Náuseas, diarrea, cefalea, dolor en el sitio de inyección. Convulsiones (raro).",
                "biodisponibilidad": "No oral (uso parenteral).",
                "precauciones": "Alergia a carbapenems, penicilinas o cefalosporinas. Ajustar en IR. No cubre Pseudomonas/Acinetobacter.",
                "ajuste_renal_hepatica": "IR: Ajustar dosis según ClCr. IH: No requiere ajuste significativo.",
                "interacciones": "Valproato (disminuye niveles de valproato).",
                "alertas": ["Alergia a carbapenems"],
                "coverage_profile": { "Staphylococcus aureus (SASM)": "Buena", "Staphylococcus aureus (SARM)": "Nula", "Streptococcus pyogenes": "Excelente", "Streptococcus pneumoniae (S)": "Excelente", "Streptococcus pneumoniae (I)": "Excelente", "Streptococcus pneumoniae (R)": "Buena", "Enterococcus faecalis": "Buena", "Enterococcus faecium (VRE)": "Nula", "Haemophilus influenzae": "Excelente", "Moraxella catarrhalis": "Excelente", "Escherichia coli": "Excelente", "Klebsiella spp.": "Excelente", "Otras Enterobacteriaceae (BLEE)": "Excelente", "Pseudomonas aeruginosa": "Nula", "Acinetobacter baumannii": "Nula", "Stenotrophomonas maltophilia": "Nula", "Bacteroides fragilis": "Excelente", "Clostridium difficile": "Nula", "Mycoplasma pneumoniae": "Nula", "Chlamydia pneumoniae": "Nula", "Legionella pneumophila": "Nula" }
            },
            "Doripenem": {
                "cobertura": "Muy amplio espectro: similar a meropenem, con excelente actividad contra Pseudomonas aeruginosa, Acinetobacter y Enterobacteriaceae productoras de BLEE. Gram-positivos (excepto MRSA, VRE).",
                "posologia": "Adultos: 500 mg cada 8h IV.",
                "eventos_adversos": "Náuseas, diarrea, cefalea. Reacciones de hipersensibilidad.",
                "biodisponibilidad": "No oral (uso parenteral).",
                "precauciones": "Alergia a carbapenems, penicilinas o cefalosporinas. Ajustar en IR.",
                "ajuste_renal_hepatica": "IR: Ajustar dosis según ClCr. IH: No requiere ajuste significativo.",
                "interacciones": "Valproato (disminuye niveles de valproato).",
                "alertas": ["Reacciones de hipersensibilidad"],
                "coverage_profile": { "Staphylococcus aureus (SASM)": "Buena", "Staphylococcus aureus (SARM)": "Nula", "Streptococcus pyogenes": "Excelente", "Streptococcus pneumoniae (S)": "Excelente", "Streptococcus pneumoniae (I)": "Excelente", "Streptococcus pneumoniae (R)": "Buena", "Enterococcus faecalis": "Buena", "Enterococcus faecium (VRE)": "Nula", "Haemophilus influenzae": "Excelente", "Moraxella catarrhalis": "Excelente", "Escherichia coli": "Excelente", "Klebsiella spp.": "Excelente", "Otras Enterobacteriaceae (BLEE)": "Excelente", "Pseudomonas aeruginosa": "Excelente", "Acinetobacter baumannii": "Excelente", "Stenotrophomonas maltophilia": "Nula", "Bacteroides fragilis": "Excelente", "Clostridium difficile": "Nula", "Mycoplasma pneumoniae": "Nula", "Chlamydia pneumoniae": "Nula", "Legionella pneumophila": "Nula" }
            }
        };

        // === LÓGICA DE VISUALIZACIÓN ===
        const contentArea = document.getElementById('content-area');
        const detailArea = document.getElementById('detail-area');
        const antibioticList = document.getElementById('antibiotic-list');

        // Mapeo de colores cobertura (Igual que en tu script original)
        const coverageColors = {
            "Excelente": "#dcfce7", "Buena": "#e0f2fe", "Moderada": "#fef3c7",
            "Limitada": "#fee2e2", "Nula": "#f3f4f6", "Variable": "#eef2ff"
        };

        function init() {
            // Generar botones
            for (const abx in antibioticsData) {
                const btn = document.createElement('button');
                btn.className = 'btn-antibiotico';
                btn.textContent = abx;
                btn.onclick = () => showDetails(abx, btn);
                antibioticList.appendChild(btn);
            }
        }

        function showDetails(name, btnElement) {
            // Activar clase visual
            document.querySelectorAll('.btn-antibiotico').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');

            const data = antibioticsData[name];
            detailArea.classList.remove('hidden');
            
            // Construir HTML de detalles (Colores pastel rotativos css bg-blue-50 etc se pueden usar si tienes tailwind cargado)
            let html = `<h2 class="section-title text-2xl mb-4">${name}</h2>`;

            if (data.alertas && data.alertas.length > 0) {
                html += `<div class="alert-box"><strong><i class="fas fa-exclamation-triangle"></i> Advertencias Clave:</strong>`;
                data.alertas.forEach(a => html += `<span>• ${a}</span>`);
                html += `</div>`;
            }

            const fields = [
                { label: 'Cobertura', val: data.cobertura },
                { label: 'Posología', val: data.posologia },
                { label: 'Eventos Adversos', val: data.eventos_adversos },
                { label: 'Biodisponibilidad', val: data.biodisponibilidad },
                { label: 'Precauciones', val: data.precauciones },
                { label: 'Ajuste Renal/Hepático', val: data.ajuste_renal_hepatica },
                { label: 'Interacciones', val: data.interacciones }
            ];

            fields.forEach(f => {
                html += `<div class="antibiotic-detail-item bg-slate-50"><strong>${f.label}:</strong> ${f.val}</div>`;
            });

            // Contenedor para D3
            if (data.coverage_profile) {
                html += `<h4 class="subsection-title"><i class="fas fa-chart-bar"></i> Espectro de Cobertura</h4>`;
                html += `<div id="d3-container" class="coverage-svg-container"></div>`;
                html += renderLegend();
            }

            contentArea.innerHTML = html;

            if (data.coverage_profile) {
                renderD3Chart(data.coverage_profile);
            }
            
            // Scroll suave hacia detalles
            detailArea.scrollIntoView({ behavior: 'smooth' });
        }

        function renderLegend() {
            let html = '<div class="coverage-legend">';
            for (const [level, color] of Object.entries(coverageColors)) {
                // Mapeo simple de clases css a estilos inline para el ejemplo
                let borderColor = color; // Simplificación
                html += `<span class="coverage-tag" style="background:${color}; color:#333; border:1px solid #ccc">${level}</span>`;
            }
            html += '</div>';
            return html;
        }

        // Lógica D3 Simplificada para un solo antibiótico
        function renderD3Chart(profile) {
            const container = d3.select("#d3-container");
            container.html('');

            const micros = Object.keys(profile);
            const cellHeight = 30;
            const width = 600; // Ancho fijo o dinámico
            const height = micros.length * cellHeight + 40;

            const svg = container.append("svg")
                .attr("width", "100%")
                .attr("height", height)
                .attr("viewBox", `0 0 ${width} ${height}`);

            let y = 10;
            micros.forEach(micro => {
                const level = profile[micro];
                const color = coverageColors[level] || "#fff";

                // Fila fondo
                svg.append("rect")
                    .attr("x", 0).attr("y", y)
                    .attr("width", 250).attr("height", cellHeight - 5)
                    .attr("fill", "#f1f5f9").attr("rx", 4);
                
                // Texto Microorganismo
                svg.append("text")
                    .attr("x", 10).attr("y", y + 18)
                    .text(micro)
                    .attr("font-size", "12px")
                    .attr("font-family", "Roboto")
                    .attr("fill", "#333");

                // Barra Cobertura
                svg.append("rect")
                    .attr("x", 260).attr("y", y)
                    .attr("width", 150).attr("height", cellHeight - 5)
                    .attr("fill", color).attr("rx", 4)
                    .attr("stroke", "#cbd5e1");

                // Texto Nivel
                svg.append("text")
                    .attr("x", 335).attr("y", y + 18)
                    .attr("text-anchor", "middle")
                    .text(level)
                    .attr("font-size", "11px")
                    .attr("font-weight", "bold")
                    .attr("fill", "#333");

                y += cellHeight;
            });
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>